# [Book] SQL 첫걸음

이번에 정리할 책은 [SQL 첫걸음](https://www.yes24.com/Product/Goods/22744867)이라는 책이다. 데이터베이스를 처음 배운다면 이 책을 추천한다.

## 목차

- [데이터베이스](#데이터베이스)
- [DBMS](#dbms)
- [다양한 데이터베이스](#다양한-데이터베이스)
- [RDBMS 사용 시스템](#rdbms-사용-시스템)
- [SQL의 방언과 표준화](#sql의-방언과-표준화)
- [데이터베이스 서버](#데이터베이스-서버)
- [예약어와 DB 객체명](#예약어와-db-객체명)
- [테이블](#테이블)
- [검색](#검색)
- [정렬](#정렬)
- [결과 행 제한하기 - LIMIT](#결과-행-제한하기---limit)
- [수치연산](#수치연산)

## 데이터베이스

데이터란 컴퓨터 안에 기록되어 있는 숫자를 의미하며, 이러한 데이터의 집합을 데이터베이스라고 한다. 넓은 의미에서는 컴퓨터 안에 기록된 모든 것이라 할 수 있는데 여기서 말하는 데이터베이스는 특정 데이터를 확인하고 싶을 때 간단하게 찾아낼 수 있도록 정리된 형태를 가리킨다.

주기억장치에 데이터를 저장한다면 휘발성이므로 전원을 끄면 모든 데이터가 사라진다. 데이터베이스 내의 데이터는 영구적으로 보존되어야하므로 하드디스크나 플래시메모리(SSD) 등 비휘발성 저장장치에 저장한다.

### 시스템 내의 데이터베이스

현재는 데이터베이스가 개인용 컴퓨터나 휴대용 기기에 내장되어 있기도 한다.

- 웹 시스템과 데이터베이스
- POS 시스템과 데이터베이스
- 휴대전화의 데이터베이스

> 데이터베이스는 다양한 시스템에서 사용한다.

## DBMS

데이터베이스 즉 DB는 저장장치 내에 정리되어 저장된 데이터의 집합이고, 이를 효율적으로 관리하는 소프트웨어를 데이터베이스 관리 시스템(Database Management System), 약자로 DBMS라 부른다.

### DBMS가 필요한 이유

- 생산성: 어떤 시스템에서든 데이터 검색, 추가, 삭제, 갱신과 같은 처리가 이루어지는데 이러한 기본 기능을 DBMS가 제공한다.
- 기능성: DBMS는 DB를 다루는 기능을 많이 제공한다. 복수 유저의 요청에 대응, 대용량 데이터 저장 및 고속 검색 지원 더 나아가 DB 관리 기능을 유저가 확장할 수도 이어 유연하게 시스템을 개발할 수 있다.
- 신뢰성: 대규모 DB는 많은 요청에 대응할 수 있도록 만들어져 있다. 이를 위해 하드웨어를 여러 대로 구성하여 신뢰성 향상과 성능이 향상되고, 일부 DBMS는 컴퓨터 여러 대를 두고, 소프트웨어를 통해 확장성과 부하 분산을 구현한다. 이를 보통 클러스터 구성 또는 스케일 아웃이라 부른다.

또한 많은 DBMS가 DB의 데이터를 다른 저장장치로 내보내거나 DB 안에 데이터를 집어넣는 등의 기능을 지원한다. 이를 통해 DB를 간단하게 백업할 수도 있다.

> DBMS란 DB를 관리하는 소프트웨어로, 사용 목적은 생산성 향상과 가능성, 신뢰성 확보에 있다.

### DB를 조작하는 언어 SQL

DBMS를 이용하면 DB를 참조할 수 있고 데이터를 추가하거나 삭제, 갱신할 수 있는데 이처럼 DBMS와의 대화에 필요한 것이 SQL이다. SQL은 관계형 데이터베이스 관리 시스템(RDBMS: Relational Database Management System)을 조작할 때 사용한다.

SQL은 IBM이 개발한 SEQUEL이라는 관계형 데이터베이스 조작용 언어를 기반으로 만들어졌다. 현재 ISO 등에 의해 표준화가 진행되었다.

> SQL은 관계형 DB에서 사용한다.

### SQL명령의 종류는 크게 3가지

- DML: Data Manipulation Language의 약자. DB에 새롭게 데이터를 추가하거나 삭제, 갱신하는 등 데이터를 조작할 때 사용한다. SQL의 가장 기본이 되는 명령셋(set)이다.
- DDL: Data Definition Language의 약자. DB는 DB Object라는 데이터 그릇을 이용하여 데이터를 관리하는데, 이 같은 객체를 만들거나 삭제하는 명령어이다.
- DCL: Data Control Language의 약자. 데이터를 제어하는 명령어이다. DCL에는 트랜잭션을 제어하는 명령과 데이터 접근권한을 제어하는 명령이 포함되어 있다.

> SQL 명령은 DML, DDL, DCL의 세 종류로 나뉜다.

## 다양한 데이터베이스

-DBMS는 데이터 저장 방법에 따라 몇 가지로 분류할 수 있다.

### 계층형 데이터베이스

역사가 오래된 DBMS로, 폴더와 파일 등의 계층 구조로 데이터를 저장하는 방식의 데이터베이스다. 하드디스크나 DVD 파일시스템을 계층형 데이터베이스라고 할 수 있다. 하지만 현재 DBMS로서 채택되는 경우가 많지 않다.

### 관계형 데이터베이스

관계 대수라는 것에 착안하여 고안한 데이터베이스이다. 관계 대수란 행과 열을 가지는 표형식 데이터를 저장하는 형태의 데이터베이스를 가리킨다.

### 객체지향 데이터베이스

가능하면 객체 그대로를 데이터베이스의 데이터로 저장하는 것이 객체지향 데이터베이스이라 한다.

### XML 데이터베이스

XML 형식으로 기록된 데이터를 저장하는 데이터베이스이다. XML 데이터베이스에는 SQL 명령을 사용할 수 없다. 대신ㄴ XML 데이터를 검색할 때는 XQuery라는 명령어를 사용한다.

### 키-밸류 스토어 (KVS)

키와 그에 대응하는 값이라는 단순한 형태의 데이터를 저장하는 데이터베이스이다. NoSQL이라는 슬로건으로부터 생겨난 데이터베이스로 열 지향 데이터베이스라고도 불린다.

## RDBMS 사용 시스템

- 메인 프레인: 다운사이징으로인해 소형 워크스테이션으로 대체
- 대형 범용기기
- 웹 시스템과 RDBMS
- 안드로이드에 포함된 SQLite: 휴대단말 등 작은 하드웨어용으로 경량화한, 임베디드 시스템에 자주 쓰이는 RDBMS다.

### RDBMS 종류

- Oracle
- DB2
- SQL server
- PostgreSQL
- MySQL
- MariaDB
- SQLite

## SQL의 방언과 표준화

RDBMS는 처음부터 SQL 명령어를 이용해 DB를 조작하도록 설계된만큼, SQL을 사용할 수 없는 RDBMS는 없다. 하지만 각 DB 제품별로 기능 확장이 이루어지는 과정에서 SQL을 사용하는 명령어가 달랐는데 이를 고유 방언이라고 부른다. 즉, 원리는 같지만 SQL 사용하는 방법이 제각각 조금씩 다르다는 의미다.

> SQL에는 방언이 있다. 방언 대신 표준 SQL을 사용하는 편이 좋다.

## 데이터베이스 서버

많은 RDBMS가 클라이언트/서버 모델을 채택해 가동중이다. 특히 웹시스템과 연동하는 RDBMS라면 접속자 수가 수백, 수천명에 달하는 전용 DB 서버를 운용하는 일도 드물지 않다.

RDBMS는 복수의 클라이언트가 보내오는 요청에 응답할 수 있도록 클라이언트/서버 모델로 동작한다.

### 클라이언트/서버 모델

클라이언트/서버 모델이란 사용자 조작에 따라 요청을 전달하는 클라이언트와 해당 요청을 받아 처리하는 서버로 소프트웨어를 나누고, 복수의 컴퓨터 상에서 하나의 모델을 구현하는 시스템을 말한다.

RDBMS는 사용자 별로 DB 접근을 제한할 수 있다. 이 때문에 DB를 사용하기 위해서는 사용자 인증을 거쳐야 한다. 사용자 인증은 ID, PW로 실행되고, 인증 실패시 DB에 접속할 수 없다.

> DB를 사용할 때는 ID와 PW를 이용한 사용자 인증이 필요하다.

실제로 DB에 접속하는 것은 PHP나 루비 등의 프로그래밍 언어로 만들어진 CGI 프로그램이다. DB 서버를 사용하기 위해서는 먼저 DB 서버와의 접속이 성립되어야 하며, 그 후 DB에 필요한 SQL 명령을 전달하고, 실행결과는 클라이언트로 되돌아간다. 이 때 웹 서버의 CGI 프로그램이 DB의 클라이언트가 된다.

실제로 대규모 시스템에서는 웹 서버나 DB 서버를 여러 대로 구성하여 운용하는 경우도 많다.

> 클라이언트/서버 모델은 유여한 하드웨어 구성을 실현한다.

## 예약어와 DB 객체명

SELECT와 FROM 같은 키워드가 예약어이다. DB에는 테이블 외에 다양한 데이터를 저장하거나 관리하는 어떤 것을 만들 수 있는데 이것을 DB 객체라 부른다. 예를 들면 뷰(VIEW)가 이에 해당한다. 또한 DB 객체의 이름은 서로 중복될 수 없다는 점과 예약어를 DB 객체의 이름으로 사용할 수 없다는 점을 유의하자.

> DB 객체는 테이블 또는 뷰에 해당한다.

예약어와 DB 객체명은 대소문자를 구별하지 않는다. 다만 회사마다 대문자로 사용하는 것을 통일할 수 있고 또는 소문자로만 사용하는 것으로 정의할 수도 있다.

## 테이블

![table-1](/book/sql-first-step/images/table-1.png)
(사진 출처: https://hongong.hanbit.co.kr/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-databasedb-dbms-sql%EC%9D%98-%EA%B0%9C%EB%85%90/)

표 형식의 데이터를 테이블이라 부르고 행(레코드)과 열(컬럼/필드)로 구성된다. 행은 모두 동일한 형태로 되어 있으며 옆으로 열(컬럼/필드)이 나열되는데 열마다 이름이 지정되어 있다. 각각의 행과 열이 만나는 부분을 셀 이라고 부른다. 셀에는 하나의 데이터 값이 저장되어 있다.

> 하나의 셀: 화사, 솔라, flower 등등..

또한 데이터는 자료형으로 분류할 수 있다. 열은 하나의 자료형만 가질 수 있다. 예를 들면, 숫자만으로 구성된 데이터를 수치형 데이터, 문자열로 구성된 데이터를 문자열형 데이터, 날짜와 시각을 나타내는 날짜시간형 데이터 등이 있다.

### NULL

값이 없는 데이터를 NULL이라 한다. NULL은 데이터가 들어있지 않은 것을 의미하는 특별한 값이다.

### DESC

```sql
DESC sample21;
```

DESC 명령어를 사용하면 테이블에 어떤 열이 정의되어 있는지, 어떤 자료형인지, NULL을 허용하는지, 키 값이 무엇인지, 디폴트 값이 있는지 등 전체정보를 알 수 있다. (참고로 DESC는 SQL 명령어가 아니다.)

> DESC 명령으로 테이블 구조를 참조할 수 있다.

### 자료형

전에 테이블에는 자료형이 있다 했다.

- INTEGER: 정수값을 저장할 수 있는 자료형
- CHAR: 문자열을 저장할 수 있는 자료형
- VARCHAR: 문자열을 저장할 수 있는 자료형
- DATE: 날짜값을 저장할 수 있는 자료형
- TIME: 시간을 저장할 수 있는 자료형

### CHAR VS VARCHAR

CHAR형은 언제나 고정된 길이로 데이터가 저장된다. 그에 따라 고정 길이 문자열 자료형이라고 한다. CHAR형에서는 길이가 고정되기 때문에 최대 길이보다 작은 문자열을 저장할 경우 공백문자로 나머지를 채운 후 저장하게 된다.

반면에 VARCHAR형은 저장할 문자열의 길이에 맞춰 저장공간을 가변적으로 사용하여 저장한다. 그에 따라 가변 길이 문자열 자료형이라고도 한다. 이렇게만 보면 실무에서는 거의 VARCHAR 사용이 불가피한 선택인 것 같다.

이외에도 많은 자료형이 있으니 구글에 검색해보자.

## 검색

- A.NAME = B.NAME : 같은지 비교
- A.PRICE > B.PRICE : 누가 더 큰지, 작은지 비교
  - A.PRICE < B.PRICE
  - A.PRICE >= B.PRICE
  - A.PRICE <= B.PRICE
- A.PRICE <> B.PRICE : 다른지 비교, 다른 경우 TRUE
- IS NULL : NULL인 경우만 검색
- AND : 모든 조건 만족시
- OR : 하나의 조건이라도 만족시
- NOT : 조건의 부정
- LIKE : 패턴 검색

### 이스케이프

- `%%%` 처럼 %를 포함한 문자열을 검색하려면 `%\%%` 처럼 앞에 `\`를 붙여야 한다.
- 마찬가지로 `It's`를 검색한다고 했을 때 `'It's'` 이와 같이 검색하는 것이 아니라 `'It''s'` 이와 같이 `'`를 2개 연속해서 사용한다.
- 간단한 패턴 매칭이라면 LIKE로 충분하다만 더 복잡한 패턴을 매칭하는 경우는 정규 표현식(Regular Expression)을 사용하는 편이 더 낫다. 또한 최근에는 대부분의 DB가 정규표현식을 지원한다.

## 정렬

```sql
ORDER BY ROW_NO DESC
```

ORDER BY 키워드를 사용하여 리스트를 정렬할 수 있다. 다만 정렬시 주의할 점이 있다.

| A   | B   |
| --- | --- |
| 1   | 1   |
| 2   | 2   |
| 10  | 10  |
| 11  | 11  |

위 테이블에서 A열은 문자열(VARCHAR)이고, B열은 수치형(INTEGER)이다.

```sql
SELECT * FROM SAMPLE311 ORDER BY A
```

| A   | B   |
| --- | --- |
| 1   | 1   |
| 10  | 10  |
| 11  | 11  |
| 2   | 2   |

위 명령어를 실행하면 위와 같은 표로 보여준다. A열에서 1 다음에 2가 나올줄 알았지만 10이 나온 것이다. 그 이유는 A열은 문자열(VARCHAR)이고 문자열은 대소관계를 사전식 순서로 비교했기 때문에 이러한 상황이 발생한다.

```sql
SELECT * FROM SAMPLE311 ORDER BY B
```

만약 위와 같이 B로 정렬했다면 정상적으로 보여주었을 것이다. 그 이유는 B열은 수치형(INTEGER)이기 때문이다.

ORDER BY는 테이블에 영향을 주지 않는다. ORDER BY를 이용해 행 순서를 바꿀 수 있을뿐 저장장치에 저장된 데이터의 행 순서를 변경하는 것은 아니다. SELECT 명령은 데이터를 검색하는 명령이다. 이는 테이블의 데이터를 참조만 할 뿐이며 변경은 하지 않는다.

### 복수의 열을 지정해 정렬하기

```sql
SELECT 열명 FROM 테이블명 ORDER BY 열명1, 열명2...
```

### NULL 값의 정렬순서

NULL은 데이터가 들어있지 않은 것을 의미하는 특별한 값이라고 했다. 특성상 대소비교를 할 수 없어 정렬 시에는 별도의 방법으로 취급한다.

ORDER BY로 지정한 열에서 NULL값을 가지는 행은 가장 먼저 표시되거나 가장 나중에 표시된다. NULL에 대한 대소비교 방법은 표준 SQL에도 규정되어 있지 않아 DB 제품에 따라 기준이 다르다.

MySQL의 경우 NULL값을 가장 작은 값으로 취급해 ASC(오름차순)에서는 가장 먼저, DESC(내림차순)에서는 가장 나중에 표시된다.

## 결과 행 제한하기 - LIMIT

```sql
SELECT 열명 FROM 테이블명 LIMIT 행수 [OFFSET 시작행]
```

웹에서 정말 많이 사용되는 페이징 구현할 때 주로 사용한다. 리스트가 몇백, 몇천, 몇만씩 된다면 모든 리스트를 가져오면 쿼리 시간이 증가한다. 이때 리스트수를 제한하기 위해 LIMIT과 OFFSET 키워드를 사용한다.

```sql
SELECT 열명 FROM 테이블명 WHERE 조건식 ORDER BY 열명 LIMIT 행수
```

- LIMIT 키워드는 가장 마지막에 쓴다.
- 정렬한 후 제한하기
  - `LIMIT 3`보다 `WHERE NO <=3`처럼 조건식을 사용해도 동일한 경과를 얻을 수 있다.
  - 다만 LIMIT과 WHERE은 기능과 내부처리 순서가 전혀 다르다.
  - LIMIT은 반환할 행수를 제한하는 기능으로, WHERE 구로 검색한 후 ORDER BY로 정렬된 뒤 최종적으로 처리된다.
- LIMIT를 사용할 수 없는 DB에서의 행 제한
  - 참고로 LIMIT은 표준 SQL이 아니기 때문에 MySQL과 PostgreSQL에서만 사용할 수 있다. 그 이외의 DBMS에서는 관련 키워드로 구글에 검색하면 확인할 수 있다.

## 수치연산

- SQL을 사용하면 사칙연산이 가능하다.
  - `+`: 덧셈
  - `-`: 뺄셈
  - `*`: 곱셈
  - `/`: 나눗셈
  - `%`: 나머지

```sql
SELECT *, price * quantity AS amount FROM SAMPLE34;
```

- 키워드 AS는 생략할 수 있다.
- 엘리어스(alias)라고도 불리는 별명은 영어, 숫자, 한글 등으로 지정할 수 있다. 단, 별명을 한글로 지정하는 경우에는 여러가지로 오작하는 경우가 많으므로 되도록 영어를 사용하자.
- 이름 지정하는 경우 숫자로 시작되지 않도록 하자.
- SELECT 구에서 지정한 별명은 WHERE 구 안에서 사용할 수 없다.
  - 표준 SQL에는 내부처리 순서가 따로 정해져 있지 않지만 대부분 WHERE -> SELECT 순서로 내부 처리를 하기 때문이다.
- NULL값에 사칙연산을 하면 NULL이 된다.
  - 하지만 나눗셈의 경우 아에 에러가 발생하니 주의하자.

> alias 이름에 한글 즉, ASCII 문자 이외의 것을 포함할 경우는 더블쿼트로 둘러싸서 지정한다.
