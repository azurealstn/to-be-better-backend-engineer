# 자바 메모리 구조

자바의 메모리 구조는 크게 메서드 영역, 스택 영역, 힙 영역 3개로 나눌 수 있다.

- **메서드 영역:** 클래스 정보를 보관한다.
- **스택 영역:** 실제 프로그램이 실행되는 영역이다. 메서드를 실행할 때 마다 하나씩 쌓인다.
- **힙 영역:** 객체(인스턴스)가 생성되는 영역이다. new 명령어를 사용하면 이 영역을 사용한다.

### 메서드 영역(Method Area)

메서드 영역은 프로그램을 실행하는데 필요한 공통 데이터를 관리한다. 이 영역은 프로그램의 모든 영역에서 공유한다.

- 클래스 정보: 클래스의 실행 코드(바이트 코드), 필드, 메서드와 생성자 코드등 모든 실행 코드가 존재한다.
- static 영역: `static` 변수들을 보관한다.
- 런타임 상수 풀: 프로그램을 실행하는데 필요한 공통 리터럴 상수를 보관한다. 이 외에도 프로그램을 효율적으로 관리하기 위한 상수들을 관리한다.

### 스택 영역(Stack Area)

자바 실행 시, 하나의 실행 스택이 생성된다. 각 스택 프레임은 지역 변수, 중간 연산 결과, 메서드 호출 정보 등을 포함한다.

- 스택 프레임: 메서드를 호출할 때 마다 하나의 스택 프레임이 쌓이고, 메서드가 종료되면 해당 스택 프레임이 제거된다.
- 스택 영역은 각 쓰레드별로 하나의 실행 스택이 생성된다. 따라서 쓰레드 수 만큼 스택 영역이 생성된다.

### 힙 영역(Heap Area)

객체(인스턴스)와 배열이 생성되는 영역이다. 가비지 컬렉션(GC)이 이루어지는 주요 영역이며, 더 이상 참조되지 않는 객체는 GC에 의해 제거된다.

### 스택 영역과 힙 영역

스택 영역과 힙 영역이 실제로 어떻게 사용되는지 정말 잘 설명된 블로그가 있다. 이 블로그는 꼭 한번은 읽어보면 좋을 것 같다. (블로그: https://yaboong.github.io/java/2018/05/26/java-memory-management/)

## static 변수

- `static` 키워드는 주로 멤버 변수와 메서드에 사용된다.
- `static` 키워드를 사용하면 공용으로 함께 사용하는 변수를 만들 수 있다.
- 멤버 변수에 `static` 을 붙이게 되면 `static` 변수, 정적 변수 또는 클래스 변수라 한다.
- `static`이 붙은 멤버 변수는 메서드 영역에서 관리한다. 즉, 정적 변수는 인스턴스 영역이 아니라 메서드 영역에서 관리한다.

**멤버 변수(필드)의 종류**

- **인스턴스 변수:** `static`이 붙지 않은 멤버 변수
  - `static`이 붙지 않은 멤버 변수는 인스턴스를 생성해야 사용할 수 있고, 인스턴스에 소속되어 있다. 따라서 인스턴스 변수라 한다.
  - 인스턴스 변수는 인스턴스를 만들 때 마다 새로 만들어진다.
- **클래스 변수:** `static`이 붙은 멤버 변수
  - 클래스 변수, 정적 변수, `static` 변수등으로 부른다. **용어를 모두 사용하니 주의하자**
  - `static`이 붙은 멤버 변수는 인스턴스와 무관하게 클래스에 바로 접근해서 사용할 수 있고, 클래스 자체에 소속되어 있다. 따라서 클래스 변수라 한다.
  - 클래스 변수는 자바 프로그램을 시작할 때 딱 1개가 만들어진다. 인스턴스와는 다르게 보통 여러곳에서 공유하는 목적으로 사용된다.

### 변수와 생명주기

- **지역 변수(매개변수 포함):** 지역 변수는 스택 영역에 있는 스택 프레임 안에 보관된다. 메서드가 종료되면 스택 프레임도 제거 되는데 이때 해당 스택 프레임에 포함된 지역 변수도 함께 제거된다. 따라서 지역 변수는 생존 주기가 짧다.
- **인스턴스 변수:** 인스턴스에 있는 멤버 변수를 인스턴스 변수라 한다. 인스턴스 변수는 힙 영역을 사용한다. 힙 영역은 GC(가비지 컬렉션)가 발생하기 전까지는 생존하기 때문에 보통 지역 변수보다 생존 주기가 길다.
- **클래스 변수:** 클래스 변수는 메서드 영역의 `static` 영역에 보관되는 변수이다. 메서드 영역은 프로그램 전체에서 사용하는 공용 공간이다. 클래스 변수는 해당 클래스가 JVM에 로딩 되는 순간 생성된다. 그리고 JVM이 종료될 때 까지 생명주기가 어어진다. 따라서 가장 긴 생명주기를 가진다.

### static 사용

```java
public class Main {
    int n;
    static int m;
    // 정적 메서드 (static 메서드)
    public static void main(String[] args) {
//        n = 10; // 사용 불가
        m = 10; // 사용 가능

    }
}
```

- `static`은 인스턴스 없이 클래스의 이름을 통해 바로 호출할 수 있고, 인스턴스처럼 참조값의 개념이 없다.
- 특정 인스턴스의 기능을 사용하려면 참조값을 알아야 하는데, 정적 메서드는 참조값 없이 호출한다. 따라서 정적 메서드 내부에서 인스턴스 변수나 인스턴스 메서드를 사용할 수 없다.

### java의 main 메서드가 static인 이유

```java
public static void main(String[] args){...}
```

- 위와 같은 형식은 java에서의 main() 관례이다. 위와 같은 시그니처를 가진 메소드가 없으면 실행되지 않는다.
- JVM은 인스턴스가 없는 클래스의 main()을 호출해야하기 때문에 `static`이어야 한다.

## Reference

- [김영한의 실전 자바 - 기본편](https://www.inflearn.com/course/%EA%B9%80%EC%98%81%ED%95%9C%EC%9D%98-%EC%8B%A4%EC%A0%84-%EC%9E%90%EB%B0%94-%EA%B8%B0%EB%B3%B8%ED%8E%B8#)
- https://yaboong.github.io/java/2018/05/26/java-memory-management/
- https://github.com/WeareSoft/tech-interview/blob/master/contents/java.md#java%EC%9D%98-non-static-%EB%A9%A4%EB%B2%84%EC%99%80-static-%EB%A9%A4%EB%B2%84%EC%9D%98-%EC%B0%A8%EC%9D%B4
